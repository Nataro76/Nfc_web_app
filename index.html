
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Sample illustrating the use of Web NFC.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta http-equiv="origin-trial" content="Ai2qMFWYMxGZUzL8lUyz/1sWKYhXdJtZB9SzQyiXS4pEWzxZ7wl40gCa6r//itPf9+ldPWpre8oEcc/iiqzjogwAAABWeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZWNocm9tZS5naXRodWIuaW86NDQzIiwiZmVhdHVyZSI6IldlYk5GQyIsImV4cGlyeSI6MTU5MzYxMTUwNn0=">
    
    <title>Web NFC Sample</title>
    <script>
      // Add a global error event listener early on in the page load, to help ensure that browsers
      // which don't support specific functionality still end up displaying a meaningful message.
      window.addEventListener('error', function(error) {
        if (ChromeSamples && ChromeSamples.setStatus) {
          console.error(error);
          ChromeSamples.setStatus(error.message + ' (Your browser may not support this feature.)');
          error.preventDefault();
        }
      });
    </script>
    
    
    
    
    <link rel="icon" href="../images/favicon.ico">
    
    <link rel="stylesheet" href="../styles/main.css">
    
    
  </head>

  <body>
    

<button id="scanButton">Pair</button>
<button id="unpairButton">Unpair</button>
<button id="writeButton">Add</button>

<script>
  var ChromeSamples = {
    log: function() {
      var line = Array.prototype.slice.call(arguments).map(function(argument) {
        return typeof argument === 'string' ? argument : JSON.stringify(argument);
      }).join(' ');

      document.querySelector('#log').textContent += line + '\n';
    },

    clearLog: function() {
      document.querySelector('#log').textContent = '';
    },

    setStatus: function(status) {
      document.querySelector('#status').textContent = status;
    },

    setContent: function(newContent) {
      var content = document.querySelector('#content');
      while(content.hasChildNodes()) {
        content.removeChild(content.lastChild);
      }
      content.appendChild(newContent);
    }
  };
</script>

<h3>Live Output</h3>
<div id="output" class="output">
  <div id="content"></div>
  <div id="status"></div>
  <pre id="log"></pre>
</div>


<script>
  if (/Chrome\/(\d+\.\d+.\d+.\d+)/.test(navigator.userAgent)){
    // Let's log a warning if the sample is not supposed to execute on this
    // version of Chrome.
    if (81 > parseInt(RegExp.$1)) {
      ChromeSamples.setStatus('Warning! Keep in mind this sample has been tested with Chrome ' + 81 + '.');
    }
  }
</script>
<script>
log = ChromeSamples.log;

if (!("NDEFReader" in window))
  ChromeSamples.setStatus(
    "Web NFC is not available.\n" +
      'Please make sure the "Experimental Web Platform features" flag is enabled on Android.'
  );
</script>
 <script >

     scanButton.addEventListener("click", async () => {
    let tagValue=null;
    var assoc=null;
    let badge=null;
    log("User clicked scan button");
    try {
      const reader = new NDEFReader();
      await reader.scan();
      log("> Scan started");
  
      reader.addEventListener("error", (event) => {
        log(`Argh! ${event.message}`);
      });

        tagValue=returnSerial();
        if(tagValue=="04:82:3a:2a:ce:66:80"){
        log(`This is tag 3EE66B`);
        tagValue="3EE66B";
        assocData(tagValue);
        tagValue=null;
        }
        if(tagValue=="04:a9:34:2a:ce:66:80"){
                      log('This is tag 3EE694');
                      tagValue="3EE694";
                      assocData(tagValue);
                      tagValue=null;


        }
    } 
    catch (error) {
      log("Argh! " + error);
    }
  });
  
  writeButton.addEventListener("click", async () => {
    log("User clicked write button");
  
    try {
      const writer = new NDEFWriter();
      await writer.write("Hello world!");
      log("> Message written");
    } catch (error) {
      log("Argh! " + error);
    }
  });


function returnSerial(){
      
    reader.addEventListener("reading", ({ message, serialNumber }) => {

log(`> Serial Number: ${serialNumber}`);
log(`> Records: (${message.records.length})`);});
    return String(serialNumber);
}

function assocData(tagval){
log('Please scan your badge now . . .');
reader.addEventListener("reading", ({ message, serialNumber }) =>{
badge=String(serialNumber);
});
log(`Your badge ID is: ${badge}`);
if(confirm("Do you want to associate those values?")){
assoc = {badge:tagval};
log(`You succesfully associated tag ${tagval} with badge ${badge}`);
}
else{
log('Start again if you want to pair a new badge');   
}
        
}


</script>
  </body>
</html>
